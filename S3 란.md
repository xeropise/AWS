### Amazon S3 란?

![img](https://user-images.githubusercontent.com/50399804/133894857-485b434b-abba-48f6-8a43-c0e608e2117e.png)



- 스마트한 <u>객체 스토리지</u> 서비스

  - 다른 서비스와 연동이 쉽다.

  

- 다양한 기능을 제공한다.

  - 웹 서버 기능

  - 쿼리 기능

  - 확장 및 축소가 간단하다.

  - 다양한 관리 기능 (스토리지 클래스 분석과 리전 간 복제, 암호화 등등...)

    

- 사용하기 쉽고 견고하다는 것이 특징이다.

<br>



> 객체 스토리지?
>
> - 데이터를 객체 단위로 관리하는 형식을 말함 <br>
> - 웹 서버나 회사 내의 파일 서버와 같이 인터넷상에 데이터를 저장하는 장소를 제공해 주는 것 <br>
> - 용량 제한이 없으므로 나중을 대비해서 넉넉하게 용량을 확보할 필요 없이 최소한의 용량만으로 시작해도 좋다.



***

### S3의 특징

- 확장성

  - EC2와 마찬가지로 확장, 축소가 쉽다. 사용 목적에 맞게 다양한 스토리지 클래스가 준비되어 있고 수명주기 정책을 사용하여 자동으로 이동이 가능하다.

    

- 가용성 · 내구성

  - 99.9999999999%의 데이터 내구성을 가지고 있어, 장애나 오류, 위협에 강하다.

    

  - S3 객체는 최소 4개의 가용 영역에 자동으로 복제되어 보존되기 때문에 어느 한쪽에 장애가 발생하더라도 계속 사용할 수 있다.

    

- 신뢰성

  - 암호화 기능과 접근 관리 도구가 있어 공격으로부터 지키기 쉽다. 

    

  - 각종 규정을 준수하며 감사 기능을 갖추고 있다. 

    - PCI-DSS, HIPAA/HITECH, FedRAMP, 유럽 연합(EU) 데이터 보호 규칙 및 FISMA 등 규정 준수 프로그램 유지

    

- 다양한 관리 기능

  - 스토리지 클래스 분석, 수명 주기 정책 등을 시작으로 각종 관리 기능이 있다.

    

  - 관리 기능을 사용하면 실제 사용 환경에 맞는 스토리지 클래스를 선택하는 것이 가능하다.

    

- 스마트한 기능

  - S3 Select라는 데이터에 쿼리를 실행하는 기능과 서비스가 있다.

    

  - 그 외에 Amazon Athena, Amazon Redshift Spectrum 등의 분석 서비스와 호환되고, AWS Lambda와 연동할 수 있다.



<br>

***

### 요금 특징

- 스토리지 클래스(종류)와 리전에 따라 다르지만, 기본적인 계산식은 다음으로 계산된다.

  - '종량 과금' = '보유하고 있는 용량(데이터를 저장한 양에 따라 과금)' + '전송량(데이터를 주고 받은 전송량에 따라 과금)'

    

- 스토리지 클래스에 따라 일할(일단위로 나눔)하여 계산하는 경우와 30일 단위, 90일 단위, 180일 단위로 계산하는 경우 등 방식이 다르다.

  - 스토리지 클래스에 따라서 최소 용량 요금이 설정되어 있어, 크기보다 작은 파일인 경우도 올림하여 요금이 부과된다.

    

- S3에 대해 파일을 받거나 보낼 때 발생하는 요금인 전송량은 수신 요청(GET)이나 송신 요청(PUT)에 대해서 1GB 단위로 과금된다.



<br>

***

### 스토리지 클래스 - 다양한 종류의 스토리지

- 스토리지 클래스란?

  - 스토리지의 종류로 Standard 외에도 액세스 패턴에 따라 계층(비용이 다른 층)을 이동할 수 있는 클래스, 액세스가 빈도가 낮은 데이터를 위한 클래스 등이 있어서 사용자가 사용 목적에 맞춰서 선택이 가능하다.

    

- 버킷(객체를 저장하는 컨테이너) 단위가 아니고 객체(파일) 단위로 클래스를 선택할 수도 있다.

  

- 상황에 따라 변경할 수 있는 점이 큰 장점이며, 변경은 수동으로 해야 하지만 수명 주기 정책을 설정하며 자동으로 수행하도록 하는 것도 가능하다.



- 스토리지 클래스의 종류는 다음과 같다.

  1. Standard

     - 가장 일반적인 스토리지 클래스

       

     - 3곳 이상의 AZ(Access Zone: 가용 영역)에 데이터가 저장되어 있기 때문에 99.9%의 가용성(시스템이 계속해서 가동하는 것)을 보장한다.

       

     - 데이터를 검색할 때의 요금과 최소 용량(최소량)의 요금이 없고 일할로 계산되므로 쉽게 사용하기에 좋은 클래스이다.

       

  2. Intelligent-Tiering

     - 빈번한 액세스와 간헐적 액세스에 최적화된 두 가지 계층에 객체(파일)를 저장한다.

       

     - 어느 쪽에 저장할지는 객체별로 모니터링하여 그 결과에 따라 자동으로 이동된다.

       - 30일간 연속으로 액세스가 없는 객체는 간헐적 액세스 계층으로 이동, 액세스가 늘어나면 다시 빈번한 액세스 계층으로 이동된다.

         

     - 이 클래스에는 검색 요금이 부과되지 않는다. 액세스 계층 간 이동에 대한 요금도 부과되지 않는다.

       

     - 자주 사용되는 파일과 자주 사용도지 않는 파일이 섞여 있어서 액세스 빈도가 자주 바뀌는 경우에 비용을 줄일 수 있다.

       

     - 기본적으로 Standard와 동일하지만 최소 저장 기간에 대한 요금이 설정되어 있으므로 주의가 필요하다.

     

  3.  Infrequent Access

     - Standard 클래스에 비해 저장 요금이 낮게 설정되어 있는 대신에 액세스 요금이 조금 높게 설정되어 있다. 

       

     - 액세스 빈도가 낮고 용량이 큰 데이터에 적합하다.

       

     - 같은 Infrequent Access 중에서도 OneZone - Infrequent Access와 Standard - Infrequent Access는 저장에 사용되는 AZ의 수가 다르다.

       - OneZone의 경우 해당 지역에 물리적인 문제가 발생하면 데이터를 유실한 가능성이 있다.

         - 낮은 가격에 데이터를 보관할 수 있지만, 절대 유실하면 안 되는 데이터를 보관하기에는 맞지 않다.

           

  4. Reduced Redundancy Storage

     - 스토리지 클래스가 아닌 옵션으로 분류되지만 한 종류밖에 없기 때문에 실질적으로 스토리지 클래스의 하나라고 생각하는 것이 좋다.

       

     - Standard에 비해 이중화 수준을 낮춰서 낮은 가격으로 제공하고 있다. 저장되는 AZ가 한 군데이므로 문제가 발생할 경우에 데이터를 유실할 가능성이 있다.

       

  5. S3 Glacier / S3 Glacier Deep Archive

     - 데이터 아카이브와 장기간 백업을 고려하여 만든 스토리지 클래스이다. 다른 클래스와 마찬가지로 좋은 내구성을 가지고 있고, 가격이 낮기 때문에 대용량 데이터를 저렴한 가격으로 보관할 수 있다.

       

     - 데이터는 '볼트' 라고 하는 컨테이너에 저장된다. <u>저장된 데이터를 읽는 경우 다른 S3 버킷으로 옮겨야 하는 작업이 필요하다.</u>

       

     - 범위로 검색해서 일부 데이터만 검색할 수도 있지만, 기본적으로는 통째로 검색한다.

       

     - 검색할 경우, Glacier 상의 데이터와 검색 대상의 데이터 양쪽에 요금이 부과되므로 주의하자.



<br>

***

### S3의 사용절차 - 스토리지 서비스를 사용하기까지



#### S3 조작

![제목 없음2](https://user-images.githubusercontent.com/50399804/133894939-2c79bb2f-a678-48ae-8972-03673b914b43.png)

​	

- 버킷의 생성 및 각종 설정과 같은 기본적인 S3 조작은 관리 콘솔의 S3 대시보드에서 수행한다.

  

- 가장 기본적으로 객체(파일)의 업로드를 수행할 수 있다.

  - 일반적인 파일을 업로드하려면 매번 관리 콘솔에서 로그인해야 하기 때문에 번거롭지만, S3의 경우 API와 SDK 를 사용하여 업로드할 수 있어 편리하다.

    

  - 또한, AWS Transfer foe SFTP 가 제공되어, SFTP ([SSH](https://velog.io/@hyeseong-dev/%EB%A6%AC%EB%88%85%EC%8A%A4-ssh%EB%9E%80) 로 암호화된 파일 전송 프로토콜)로 액세스할 수 있다.



<br>

***

### S3 서비스의 기능

- 용어들에 대해 알아보자.

  

| 항목                               | 내용                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| 객체                               | S3의 엔티티 단위, 텍스트나 이미지등의 파일                   |
| 버킷                               | 객체를 저장하는 컨테이너, 모든 객체는 버킷에 저장된다.       |
| 버킷명                             | <u>S3 버킷의 명칭은 다른 AWS 사용자를 포함하여 유일한 이름</u>이어야 한다.  <br>웹 서버로 사용할 경우는 도메인명이 버킷명이 된다. |
| 객체 키                            | 객체 식별자로 모든 객체는 반드시 한 개의 키를 가진다. <br>버킷, 객체, 키, 버전을 조합하여 객체를 고유하게 식별한다. 이름이라고 생각하자. |
| 객체 메타데이터                    | 이름과 값의 세트, 객체를 업로드할 때 설정할 수 있다. <br>객체 키는 S3가 파일을 식별하기 위한 데이터이지만 메타데이터는 사람이 파일을 쉽게 관리하기 위한 데이터이다. |
| 리전                               | 버킷의 물리적인 보관 장소가 있는 지역을 말한다. (Us-East, Asia-Seoul ... 등등) |
| Amazon S3의 <br>데이터 일관성 모델 | S3는 가용성을 유지하기 위해 데이터를 자동으로 복제하여 저장하지만 쓰기 지연에 의한 데이터 불일치가 발생하면 <br>안 되기 때문에 데이터의 무결성을 보장한다. 복제가 모두 반영되기까지 다소 시간이 걸릴 수 있다. |
| 버전 관리                          | 여러 버전을 보관하는 것이다. 다른 버전은 별도의 객체로 취급하는 것이 가능하다. |
| 로그                               | 버킷 단위나 객체 단위의 로그를 기록할 수 있다. 하지만 객체 수준의 경우 유료이다. |
| 암호화                             | S3에 저장되는 데이터를 자동으로 암호화할 수 있다.            |
| 액세스 제어                        | S3 버킷에 대해 권한을 설정할 수 있다.                        |
| 웹 서비스                          | S3 버킷을 웹 사이트로 사용하는 기능이다.                     |



<br>

***

### S3 사용절차

- S3를 사용하려면 EC2와 마찬가지로 관리 콘솔에서 S3 대시보드를 열고 버킷을 생성해야 한다.

  

- S3는 매니지드 서비스이므로 기본적으로 대시보드에서 작업한다. EC2처럼 SSH로 접속하지 않는다.

  

- 또한 FTP도 지원하지 않는다. 대시보드 외에는 S3를 지원하는 전용 도구를 사용하면 접속할 수 있다.

  

- 간략하게 요약하면 다음과 같다.

  - AWS에 로그인한다.

    

  - 버킷을 만든다.

    

  - 버킷을 설정한다. 

    - 웹 서버로 사용할 경우, Static website hosting 을 설정한다.

    - 접근할 수 있는 사용자를 설정한다.

      

  - 파일을 업로드 한다.



> 객체에 [태그](https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/object-tagging.html)를 달 수 있는데, 이 태그는 객체를 찾을 때 사용하거나 프로그램에 전달하는 설정 값으로 사용한다.



<br>

***

### S3 버킷 생성 전 검토해야 할 것

- <u>S3 버킷을 생성한 후에는 이름과 리전을 변경할 수 없다.</u>

  

- 반드시 정해야 할 것은 어떤 용도로 사용할 것인가이다.

  - 파일 서버인가, 로그저장소 인가?

    - 사용법에 맞게 도구나 SFTP를 준비한다. (파일 서버)
    - 접속 대상과 인증 방법을 고려해야 한다. (로그 저장소)

    

  

- 클라우드 서비스이기 때문에 최소 크기로 생성한 후, 나중에 크기를 변경할 수 있지만, 만약 웹 서버로 사용하려면 다른 용도에 비해 차이점이 많으므로 주의하자.

  

- 웹 서버로 사용할 경우, 버킷에 대한 공개, 도메인, 익명 접속 허가 등을 고려해야 한다.

  

- 구체적으로 정하기 어려운 경우는 테스트용 버킷을 생성해 보고 확인 한 후에 실제 사용할 스토리지를 생성하는 편이 좋다.



<br>

***

### 객체와 버킷이란?

- 버킷은 윈도우 드라이브와 같은 것이고, 객체는 파일과 같은 것이다.

  

- 버킷은 폴더가 아니므로 버킷 안에 버킷을 다시 만드는 것을 불가능하다.

  

- 버킷은 AWS 계정 하나당 100개까지 생성할 수 있다. (별도로 신청하면 1000개까지 늘릴 수 있다.)

  

- 객체도 단순한 파일이 아니라 관리를 위한 메타데이터도 포함되어 있다.

  

- 버킷 한 개에 저장할 수 있는 객체 수는 제한이 없고, 총 용량에도 제한이 없다.

  

- S3는 객체 스토리지이기 때문에 폴더나 디렉터리와 같은 개념이 없다. 객체는 버킷에 계층 구조가 아닌 병렬로 배치된다.

  

- 개념으로는 병렬이지만 사용상 편리를 위해서 관리 콘솔에 접속하면 폴더로 표시된다. 생성, 삭제, 업로드, 다운로드가 가능하다.



<br> 

### 버킷 생성과 명명 규칙

- 버킷을 생성하면 리전과 버킷명을 변경할 수 없기 때문에 신중하게 결정해야 한다.

  

- 특히 버킷명은 S3 안에서 유일한 이름이어야 한다. 다른 사용자가 쓰고 있는 버킷명은 사용할 수 없다.

  

- 리전을 변경해도 같은 버킷명으로 생성할 수 없기 때문에 생성한 버킷을 삭제하고 새롭게 생성해야 한다.

  

- 버킷에는 명명 규칙이 있다.

  - IP 주소 형식은 버킷명으로 쓸 수 없다.

    

  - 대문자 혹은 언더스코어는 버킷명으로 사용할 수 없다.

    

  - 버킷명은 처음과 마지막에 알파벳이나 숫자를 사용해야 한다.

    

  - DNS 명명 규칙에 따라야 하며, 3글자 이상 63글자 이하여야 한다.



<br>

***

