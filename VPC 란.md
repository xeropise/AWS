## Amazon VPC

![Picture2-2](https://user-images.githubusercontent.com/50399804/134214722-775e4c07-78d5-4612-997b-2ed8f10aea4b.png)

- AWS가 제공하는 AWS 계정 전용 가상 네트워크

  

- 네트워크와 서브넷 범위, 라우팅 테이블, 네트워크 게이트웨이 등 가상 네트워킹 환경을 설정할 수 있다.

  

- 웹 서버나 데이터베이스 서버와 같은 서버들은 네트워크에 연결되어 있어야 한다.

  

- 한 장소에 모아서 네트워크를 연결하는 것도 가능하지만 그렇게 되면 서버로서의 의미가 없다.

  

- AWS 서비스인 EC2 나 RDS(Relational Database Service) 도 마찬가지로 네트워크에 연결되어 있어야 한다.

  

- 이러한 네트워크를 구축하기 위해 사용되는 것이 Amazon Virtual Private Cloud(Amazon VPC)이다.

  

- AWS 계정 전용 가상 네트워크 서비스로, AWS에서 제공하는 리소스만 설치할 수 있다.

  

- EC2 나 RDS 의 경우 VPC를 선택하지 않으면 서버를 생성할 수 없기 때문에 리소스를 사용하기 위해서는 반드시 필요한 서비스이다.

<br>

---

### VPC의 구성

- VPC 내에 서버를 설치하면 해당 네트워크에 소속되지만, 별도로 설정하지 않으면 VPC 자체는 격리된 네트워크가 된다.

  

- 외부와 통신하려면 VPC를 인터넷 혹은 회사 LAN과 연결해야 한다.

<br>

---

### VPC의 기능

- VPC는 네트워크와 서브넷 범위, 라우팅 테이블, 네트워크 게이트웨이 등과 같은 가상 네트워킹 환경을 성절할 수 있다.

  

- 물리적인 네트워크와 다른 점도 있지만, 기본적인 개념은 같다. IPv4와 IPv6 둘 다 사용할 수 있다.

  

| 항목                                              | 내용                                                                                                                                                                                                                                                                    |
| ------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CIDR 블록                                         | [서브넷](https://hyoje420.tistory.com/32)으로 네트워크를 나눈 범위 이다. <br>VPC를 생성할 때 네트워크 범위를 CIDR로 정하고 이를 더 작은 서브넷으로 나누어 사용한다.                                                                                                     |
| [서브넷 마스크](https://limkydev.tistory.com/166) | 네트워크의 크기를 계산하는 값이다. CIDR은 서브넷 마스크의 표기법 중 하나이다.                                                                                                                                                                                           |
| 가용 영역                                         | 서브넷이 구축된 물리적 장소이다.                                                                                                                                                                                                                                        |
| 인터넷 게이트웨이                                 | 인터넷에 접속하기 위한 출입구, VPC를 인터넷에 연결하지 않을 경우에는 불필요하다.                                                                                                                                                                                        |
| 라우팅                                            | 어떤 데이터를 어디에 보낼지 조정한다.<br>인터넷 게이트웨이와 라우팅으로 데이터 송수신을 설정하지 않으면 VPC가 인터넷에 접속되지 않는다.<br>가정이나 기업의 라우터(가정의 경우 공유기) 장비가 이 역할을 수행하는 경우가 많지만<br>AWS는 소프트웨어가 이 기능을 담당한다. |
| 라우팅 테이블                                     | 라우팅에 대한 설정이 기록된 테이블이다.                                                                                                                                                                                                                                 |
| 보안 그룹                                         | AWS가 제공하는 가상 방홥겨이다.<br>인스턴스 단위로 설정하여 유입되는 데이터는 '거부' 가 기본 설정이다.                                                                                                                                                                  |
| 네트워크 ACL                                      | AWS가 제공하는 가상 방화벽이다. 서브넷 단위로 설정된다.                                                                                                                                                                                                                 |

<br>

---

### VPC 네트워크의 특징과 라우팅 테이블

- VPC 네트워크는 클라우드이기 때문에 일반 네트워크와는 조금 차이가 있다.

  - 그중 가장 큰 차이점은 라우터이다.

    

- VPC는 물리적인 라우터가 아닌 소프트웨어가 라우터 역할을 하며 라우팅을 수행한다.

  

- 라우팅은 설정된 라우팅 테이블에 따라 동작하는데, 라우팅 테이블 하나에 서브넷 여러 개를 설정할 수 있다.

  

- 물리적인 서버의 경우 LAN 케이블과 와이파이로 라우터와 연결하겠지만, 클라우드는 라우팅 테이블로 연결한다.

  

- 일반적인 서브넷 사이의 통신은 라우터로 이루어지지만, VPC의 경우 라우터 없이 직접 통신할 수 있다.

  

- VPC 하나에 인터넷 게이트웨이 한 개만 설정할 수 있다.

  

- 라우터와 인터넷 게이트웨이는 명시적인 IP 주소가 부여되지 않는다. 이는 클라우드의 특징이다.

  

- VPC 네트워크의 특징은 다음과 같다.

  - 소프트웨어가 라우팅한다. 라우터는 IP주소를 갖지 않는다.

  - 라우팅 테이블 한 개에 서브넷 여러 개를 설정할 수 있다.

  - VPC 한 개에 인터넷 게이트웨이는 한 개만 설정할 수 있고, IP 주소를 갖지 않는다.

  - 서브넷 사이의 통신은 라우터 없이 직접 통신할 수 있다.

<br>

---

### VPC의 사용 절차: 가상 네트워크를 사용하자.

- VPC를 사용하려면 관리 콘솔에서 별도로 설정해야 한다. 이때 중요한 설정이 서브넷이다.

  

- 서브넷 설정은 CIDR(Classless Inter-Domain Routing) 블록에 네트워크 범위를 설정한 후에 서브넷을 나눈다.

  

- VPC는 네트워크이므로 서버(인스턴스)가 어떤 환경에 설치되어 있는지, 그리고 인터넷에 연결해야 하는지에 대한 설정이 필요하다.

  

- 특히 중요한 것은 인터넷 연결 여부와 오토 스케일링이다.

  - 인터넷에 연결해야 한다면 인터넷 게이트웨이를 설정해야 하고, 오토 스케일링을 설정하면 서버가 자동으로 늘어나기 때문에 IP 주소를 많이 확보해 두어야 한다.
  
    
  
- 보안 그룹과 네트워크 ACL을 설정하려면, 인스턴스 용도에 맞는 포트를 설정하는 것도 고려해야 한다.

  - 모든 포트가 닫힌 것이 기본 설정이므로 서버를 사용하려면 기본 설정을 변경해야 한다.

    

  - 다만, VPC는 기본 VPC를 비롯해 기본 서브넷과 보안 그룹도 제공한다.

  

<br>



- VPC의 사용 절차는 다음과 같다.

  - VPC 이름을 정하고 CIDR 블록에 네트워크 범위를 설정한다.

    

  - 네트워크를 작게 서브넷으로 나눈다. (큰 사무실이 있고 업무별로 파티션을 나눈다고 생각하자.)

    

  - 인터넷에 접속하려면 인터넷 게이트웨이를 생성하고 라우팅을 설정(라우팅 테이블과 매핑)해야 한다.

    

  - 그 외에 보안도 설정(보안 그룹, 네트워크 ACL)해야 한다.



<br>

***

### 기본 VPC: AWS가 제공하는 기본 VPC

- AWS는 네트워크에 대한 지식이 없이도 이용할 수 있도록 리전별로 기본 VPC를 제공한다.

  

- 특별한 요건이 없는 이상, 기본 VPC를 사용하는 편이 좋다. 기본 VPC에서 Elastic Load Balancing(ELB)와 같은 서비스도 사용할 수 있다.



- 기본 VPC는 서브넷과 인터넷 게이트웨이가 기본적으로 구성되어 있다. 대시보드에서 EC2를 생성할 때나 RDS를 생성할 때도 기본 VPC를 선택할 수 있다.

  

- 네트워크의 범위는 사설 IP 주소 172.31.0.0/16이 부여된다. 기본 VPC는 기본 서브넷이라는 서브넷이 가용 영역별로 한 개씩 생성되어 있다.

  - 서울 리전의 경우 총 4군데로 각 서브넷은 /20의 주소 범위로 설정되어 있다.



| 네트워크                 | CIDR           | 네트워크의 범위             |
| ------------------------ | -------------- | --------------------------- |
| VPC 전체의 네트워크 범위 | 172.31.0.0/16  | 172.31.0.0 ~ 172.31.255.255 |
| 서브넷 1                 | 172.31.0.0/20  | 172.31.0.0 ~ 172.31.15.255  |
| 서브넷 2                 | 172.31.16.0/20 | 172.31.16.0 ~ 172.31.31.255 |
| 서브넷 3                 | 172.31.32.0/20 | 172.31.32.0 ~ 172.31.47.255 |
| 서브넷 4                 | 172.31.48.0/20 | 172.31.48.0 ~ 172.31.63.255 |



- 인터넷 게이트웨이도 구성되어 있으므로 인터넷에 접속할 수 있다. 인터넷에 접속하고 싶지 않다면 별도의 VPC 를 생성하거나 VPC 대시보드에 접속하여 기본 VPC 를 변경해야 한다.



<br>

***

### 서브넷과 DHCP: 사용할 범위 선택

![subnets-diagram](https://user-images.githubusercontent.com/50399804/134224524-d87c0175-13aa-4f2d-b4bc-969e41a512d5.png)

- VPC를 사용하려면 서브넷에 대한 지식이 있어야 한다.

  

- 서브넷은 물리적인 위치와 관계가 있기 때문에 구조에 대해 잘 이해해야 하며, 서브넷은 CIDR 표기를 사용한다.



- 서브넷은 커다란 네트워크를 작게 나눈 네트워크를 말하며, 네트워크를 분할 해 직접 통신할 수 있는 범위를 좁히고, 방화벽을 설정해 보안을 강화하는 것을 목적으로 한다.

  - AWS의 어떤 가용 영역에 서브넷을 둘지 설정한다. 즉, 서브넷은 물리적인 장소를 특정한다.

    

- VPC는 사용자가 사용할 수 있는 네트워크 범위를 생성하고, 그 아래에 용도에 따라서 서브넷(작은 네트워크)를 생성한다. 

  - 서브넷을 나누어 서브넷 A는 공개하고, 서브넷 B는 비공개하는 식으로 서브넷별로 역할을 다르게 부여할 수도 있다.

    

- 일반적인 네트워크의 경우 서브넷끼리 통신하려면 라우팅이 필요하지만, VPC의 경우에는 라우팅 없이도 통신할 수 있다.



- 네트워크와 서브넷의 범위를 나누는 데 사용되는 표기법을 CIDR(Classless Inter-Domain Routing)이라고 한다.

  - 프리픽스 표기라고도 하는데 /24, /20 처럼 네트워크 길이를 숫자로 적어서 표기한다.

    - 255.255.255.0 이나 255.255.240.0 과 같이 서브넷 마스크로 표기하는 경우도 있지만, AWS는 CIDR를 사용한다.

      

  - CIDR은 IP 주소의 수를 나타내는데 /24이면 256개, /20이면 4096개를 의미한다.

    - 자세한 설명없이 쉽게 '32 - 네트워크의 길이'의 값을 2 제곱으로 기억하면 쉽다.

      

    - 자세한 것은 [여기](https://hyoje420.tistory.com/32)를 참조하자.

      

- 일반적인 네트워크의 경우 IP 주소를 할당할 수 있는 것은 EC2 인스턴스와 RDS 인스턴스 등이다.

  

- 하지만 AWS의 VPC는 EC2 인스턴스나 RDS 인스턴스 외에도 라우터나 인터넷 게이트웨이의 IP 주소로도 예약 주소를 사용할 수 있다.

  - 서브넷의 첫 번째부터 네 번쨰까지의  IP 주소 4개와 마지막 IP 주소는 AWS에 예약된 IP 주소이기 때문에 사용할 수 없다.

    

  - 사용할 수 있는 IP 주소가 256개라면 5개를 뺸 251개가 실제로 사용할 수 있는 IP 주소가 된다.

    

- 네트워크 및 서브넷에 사용되는 IP 주소의 범위는 관리자가 설정할 수 있고, DHCP(Dynamic Host Configuration Protocol) 에서 각 호스트(인스턴스)에 IP 주소를 자동으로 할당한다.

  

- VPC에는 DHCP 서버가 동작하고 있어 인스턴스가 추가되면 해당 서브넷 범위의 IP 주소 중에 하나가 할당된다. 

  

- VPC가 일반적으로 사용하는 IP 주소는 사설 IP 주소이다.



> DHCP란?
>
> - 사용할 수 있는 IP 주소 풀을 보유하고 있어, 클라이언트에게 자동으로 IP를 할당하는 서버



<br>



***

### 라우팅과 NAT: 공인 IP 주소와  사설 IP 주소 변환

- 네트워크 간 데이터를 주고받으려면 라우팅이나 NAT(Network Address Translation - 네트워크 주소 변환) 방식을 사용해야 한다.

  

- 네트워크에 대한 기초 지식부터 알아보자.



#### 네트워크와 라우팅

- 네트워크란 PC 여러 대가 서로 통신할 수 있도록 연결되어 있는 상태를 말한다.

  

- PC가 보급되기 전에는 PC를 서로 1대1로 연결했지만, 현재는 LAN이나 WAN, 인터넷으로 연결해 라우터를 통해 데이터를 주고 받는다.

  

- 회사처럼 PC가 여러 대 있는 환경에서 PC를 1대1로 연결하려면 선이 굉장히 많아질 것이며 현실적으로 구축할 수도 없다.

  

- 데이터를 라우터로 보내고, 라우터가 목적지로 보내는 방식이 필요한데, 이를 라우팅이라 한다.

  - 말하자면 라우팅은 호스트에서 호스트로 데이터를 전달하는 형태로 데이터를 송신하는 것을 말한다.



![제목 없음](https://user-images.githubusercontent.com/50399804/134227472-50af4aee-4c58-4b06-8c81-d8602627fad3.png)



<br>



#### IP 주소와 게이트웨이

- 라우터가 각 PC에 데이터를 전달하려면 대상을 식별할 수 있는 주소가 필요하다. 이 역할을 하는 것이 IP 주소이다.

  - IP 주소는 클라이언트 PC나 서버뿐만 아니라 라우터 등 네트워크 안의 모든 호스트에 설정되어 있다.

    

- 목적지에 데이터를 보낼 떄 목적지의 IP 주소를 지정한다. 그러고 나서 데이터를 우선 네트워크 사이를 연결하는 라우터로 보낸다.

  

- 데이터를 받은 라우터는 자신의 네트워크 내에 목적지가 있는지 확인하고, 목적지가 있다면 데이터를 그 목적지(호스트)로 전달한다.

  

- 목적지가 없다면 다른 라우터로 전송한다. 라우터에는 목적지로 가장 빠르게 전송할 수 있는 경로 정보가 설정되어 있다.

  

- 라우터는 네트워크의 관문에 위치해 있기 때문에 관문이라는 의미로 게이트웨이 라고도 한다.

  - 게이트웨이 중에 '자신 이외의 접속되어 있는 모든 것' 을 기본 게이트웨이 라고한다.



<br>



#### IP 마스커레이드

- 같은 회사 안에서 데이터를 전송할 경우, 라우터를 이용하겠지만 멀리 떨어진 사람에게 데이터를 전송하는 경우 대부분 인터넷을 이용해야 한다.

  

- LAN에서 인터넷으로 데이터를 전송할 때 LAN 내부의 출입구가 되는 것이 게이트웨이이다.

  - 게이트웨이는 기기의 역할을 말하며 실제 기기는 라우터이다.

    

- LAN 내부의 PC에는 전부 사설 IP 주소를 할당하는 게 일반적이다. 하지만 인터넷상에서 공인 IP주소가 없다면 식별할 수 없기 때문에 게이트웨이가 사설 IP 주소를 공인 IP 주소로 변환하고 가정 내에서 혹은 회사 내에서는 공인 IP 주소 하나를 공동으로 사용한다.



> __공인 IP, 사설 IP ?__ 
>
> - [여기](https://velog.io/@hidaehyunlee/%EA%B3%B5%EC%9D%B8Public-%EC%82%AC%EC%84%A4Private-IP%EC%9D%98-%EC%B0%A8%EC%9D%B4%EC%A0%90)를 참조하자.

 

- 주소 변환을 담당하는 것이 IP 마스커레이드(masquerade - NAPT(Network Address Port Translation) ) 이다.



<br>



#### NAT

- IP 마스커레이드를 사용하면 내부에서 외부로 나가는 것은 가능하지만, 외부에서 내부로 들어오는 것은 불가능하다.

  

- IP 마스커레이드는 내부에서 외부로 요청하는 것에 응답하지만, 외부에서 내부로 요청하는 것에는 응답하지 않기 때문이다.

  

- PC의 경우는 문제가 없지만, LAN 환경에 서버를 설치할 경우에는 당연히 외부 요청에 대해 응답해야 한다.

  - 이럴 경우, 서버만 양방향으로 통신할 수 있도록 IP 마스커레이드를 설정할 수 있다.

    

- IP 마스커레이드는 공인 IP 하나만 설정할 수 있기 떄문에 서버가 여러 대라면 공인 IP 주소를 여러개 설정할 수 있는 NAT(Network Address Translation)을 사용해야 한다.

  

- IP 마스커레이드와 NAT는 비슷하지만, IP 마스커레이드는 1대다 인것에 비해 NAT는 다대다 라는 점이 다르다.\

  

- IP 마스커레이드는 포트를 변환할 수 있지만 NAT는 포트를 변환할 수 없다는 점도 다르다.



<br>



***

### 인터넷 게이트웨이와 NAT 게이트웨이: VPC에서 인터넷으로 접속



#### 인터넷 게이트웨이

- 인터넷 연결을 담당하며, EC2 인스턴스에 웹 사이트를 설치했을 때 웹 사이트에 접속하는 사람은 그 페이지에 접속하고 싶다는 요청을 보낸다.

  

- 요청은 DNS에서 변환되어 목적지인 공인 IP 주소로 전달되는데 EC2 인스턴스는 사설 IP 주소 밖에 설정할 수 없다.

  

- 요청된 EC2 인스턴스의 연결 정보를 가지고 있는 인터넷 게이트웨이가 공인 IP 주소를 사설 IP 주소로 변환하여 해당 EC2 인스턴스에 요청을 보낸다.



<br>



#### NAT 게이트웨이

- 회사 내부에서만 사용하는 서버의 경우에도 소프트웨어를 업데이트하려면 인터넷에 연결해야 할 때가 많다. 

  

- NAT 게이트웨이는 서브넷에서 인터넷으로 접속할 수 있지만, 인터넷에서 서브넷으로는 접속하지 못 하게 한다.



<br>



***

### 보안 그룹과 네트워크 ACL: 보안 설정

![image1](https://user-images.githubusercontent.com/50399804/134231906-103c3320-98fe-4950-a4a1-966acd80f05e.png)

- VPC의 가상 방화벽으로 보안 그룹과 네트워크 ACL이 있다.

  

- 방화벽이란 네트워크 통신을 제어하는 방식을 말한다.

  

- 보안 그룹과 네트워크 ACL은 인바운드 트래픽(데이터가 유입되는 것)과 아웃바운드 트래픽(데이터가 유출되는 것)을 제어한다.

  - 반드시 양쪽 모두 설정해야 하며 명시적으로 설정하지 않으면 기본 설정이 적용된다.



| 항목                     | 보안 그룹                                                    | 네트워크  ACL                                                |
| ------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 설정 범위 (가장 큰 차이) | 인스턴스에 대해 설정(보안 그룹을 최대 5개 할당 가능)         | 서브넷에 설정                                                |
| 규칙                     | 규칙 허용만 가능                                             | 규칙 허용와 거부가 가능                                      |
| 설정                     | 스테이트풀(stateful) - 규칙과 상관없이 반환된 트래픽을 자동으로 허용 | 스테이트리스(stateless) - 반환된 트래픽을 규칙에 따라 명시적으로 허용 |
| 규칙의 적용 순서         | 모든 규칙을 확인하여 트래픽의 허가 여부를 정한다.            | 순서대로 규칙을 처리하면서 트래픽의 허가 여부를 정한다.      |





<br>



#### 인바운드 및 아웃바운드 설정과 잘 알려진 포트

- 트래픽은 인바운드와 아웃바운드 각각에 대해 포트 단위로 허가 여부를 설정한다.

  

- 보안 그룹은 인바운드를 허가하지 않으며 아웃바운드를 허가하고, 네트워크 ACL은 양쪽 모두를 허가하는 것이 각 기본 설정이다.

  

- 그 후 보안 그룹은 필요한 포트만 허가하는 것이 일반적이다.



| 포트 번호     | 서비스          | 내용                                           |
| ------------- | --------------- | ---------------------------------------------- |
| 25            | SMTP            | 메일 송신                                      |
| 110           | POP3            | 메일 수신                                      |
| 143           | IMAP4           | 메일 수신                                      |
| 80            | HTTP            | 웹 송수신                                      |
| 443           | HTTPS           | 웹 송수신                                      |
| 22            | SSH             | SSH 통신                                       |
| 1433          | SQL Server      | 데이터베이스 통신                              |
| 1521          | Oracle Database | 데이터베이스 통신                              |
| 3306          | MySQL           | 데이터베이스 통신                              |
| 5432          | PostgreSQL      | 데이터베이스 통신                              |
| 5439          | Redshift        | 데이터 웨어하우스 통신                         |
| 20 및 21      | FTP             | 파일 전송 통신(AWS는 사용하는 경우가 드물다)   |
| 53            | DNS             | 도메인 관리 통신(AWS는 사용하는 경우가 드물다) |
| 3389          | RDP             | 원격 데스크톱 통신                             |
| 32768 ~ 65535 |                 | AWS의 경우 아웃바운드 지원                     |



<br>



***

### VPC 엔드포인트: 다른 AWS 서비스 및 엔드포인트 서비스와 연결



#### VPC 엔드포인트란

- VPC 내부에서 VPC 외부로 접속하기 위한 연결점을 제공하는 서비스이다.

  

- VPC 내 서브넷 간에는 직접 통신할 수 있고, VPC 간에도 하나의 네트워크 처럼 연결되어 통신할 수 있다.

  

- 하지만 VPC 외부의 다른 서비스와 VPC를 연결하려면 인터넷 게이트웨이를 사용해 인터넷으로 접속해야 한다.

  

- AWS의 모든 서비스가 VPC 내에 설치되어 있는 것은 아니다. (대표적으로 S3와 DynamoDB가 있다.) 인터넷 회선을 통해서 외부로 연결해야 한다면 작업도 번거롭고 보안 면에서도 불안하다.

  

- 이러한 단점을 보안하기 위해, 인터넷 게이트웨이를 통하지 않고, S3와 같은 VPC 외부에 있는 서비스와 VPC를 직접 연결해 주는 것이 엔드포인트 서비스이다.

  - VPC의 출입구로 엔드포인트를 설정하면 S3와 직접 연결할 수 있다.



<br>



#### 인터페이스 엔드포인트와 게이트웨이 엔드포인트

- VPC 엔드포인트는 가상 서비스로 확장성과 고가용성(시스템이 멈추지 않고 지속적으로 운영 가능한 성질)을 지원한다.

  

- 네트워크 트래픽에 대해 자동으로 스케일링되기 때문에 네트워크 트래픽에 대해 고민을 하지 않아도 된다.

  

- 엔드 포인트는 2종류가 있다.

  - 인터페이스 엔드포인트

    ![Interface Endpoint](https://user-images.githubusercontent.com/50399804/134234882-9b8e0773-264a-47f1-8a1e-b1837e11d4ba.png)

    - 네트워크 인터페이스(ENI, Elastic Network Interface)로 구축하는 유형

      

    - 사설 IP 주소를 가진 ENI가 존재하며, 각 서비스와 연결하는 출입구 역할을 한다.

      

    - AWS privateLink라는 방식을 사용하기 때문에 AWS 외에 타사 서비스가 PrivateLink 를 지원한다면 사용할 수 있다.

      

  - 게이트웨이 엔드포인트

    ![gateway Endpoint](https://user-images.githubusercontent.com/50399804/134234889-37a6988f-ea58-4775-af04-f1405239e946.png)

    - 라우팅 테이블에 설정된 내용을 라우팅하는 유형

      

    - 서비스 리전 단위로 라우팅 테이블을 설정하는 방식

      

    - 한 번 설정하면 해당 리전의 모든 서비스에 사용할 수 있다. S3와 DynamoDB는 이러한 형식을 취하고 있다.

      



<br>



#### VPC 엔드포인트의 요금

- 엔드포인트의 요금은 무료이지만, 인터페이스 엔드포인트의 경우에는 AWS PrivateLink를 사용하므로 이에 대한 요금이 부과된다.

  

- 인터페이스 엔드포인트가 설정되어 있으면 요금이 부과되고, 삭제하면 부과되지 않는다.

  - 인터페이스 엔드포인트 요금 = VPC 엔드포인트 1개 당 사용료 + 데이터 처리량

    

  - 게이트웨이 엔드포인트 요금 = 사용료는 무료이지만 EC2와 마찬가지로 데이터 송신료가 부과된다.



<br>



***

### VPC 연결: VPC와 VPC의 연결과 VPC와 VPN의 연결



#### VPC 연결

- VPC는 다른 VPC나 네트워크와 연결할 수 있다. 회사 내 VPC끼리 연결하는 것뿐만 아니라 다른 회사의 VPC와도 연결할 수 있다.

  - VPC끼리 연결하려면 VPC 피어링 이라는 기능을 활성화해야 한다.

    

- VPC는 물리적인 네트워크 혹은 다른 클라우드에도 접속할 수 있다.

  

- AWS를 회사 LAN이나 온프레미스 시스템과 연결하려면 물리적인 네트워크의 연장선으로 사용할 수 있다.

  - AWS는 인터넷상의 서비스뿐만 아니라 회사 시트메을 구축할 때도 사용할 수 있다.

    

- 전용선 혹은 가상 사설망(VPN, Virtual Private Network)를 사용하면 AWS와 사내 LAN이나 온프레미스를 안전하게 연결할 수 있어서 통신 내용이 누설될 걱정을 하지 않아도 된다.

  -  AWS는 전용선 서비스로 AWS Direct Connect 를 제공하며, 가상 사설망 서비스로 AWS VPN 을 제공한다.



<br>



#### 전용선과 가상 사설망

- 네트워크와 네트워크를 연결해 커다란 네트워크를 구축하는 것을 WAN(Wide Area Network)라 한다.

  - WAN은 오래전부터 있던 개념으로 본사와 지사, 지사와 지사 같이 일대일로 네트워크를 연결한다.

    

- WAN을 구축하는 방법으로 전용선으로 연결하는 경우와 가상 사설망으로 연결하는 경우가 있고, AWS와 다른 네트워크를 연결하는 경우도 있다.

  - 전용선

    - KT와 같은 통신 사업자가 직접 연결할 수 있는 회선인 전용선을 임대하여 구축, 비싸지만 안전하고 신뢰성이 높은 것이 특징

      

  - 가상 사설망

    - 보유하고 있는 회선뿐만 아니라 공용 회선을 사용하여 거점끼리 통신을 암호화하여 연결한다. 비용은 싸지만 신뢰성이 낮다.

      

    - 암호화 기술이 해석되지 않는 이상 데이터가 유출될 걱정은 없다.

      

- VPN 중에 인터넷을 사용해 구축하는 경우를 인터넷 VPN이라 한다. 인터넷 VPN은 인터넷 회선만 사용하므로 선을 끌어오기 위한 공사는 불필요하며 VPN을 지원하는 라우터만 설치하면 이용할 수 있다.



<br>



#### AWS Direct Connect

![제목 없음](https://user-images.githubusercontent.com/50399804/134237715-2d4e965f-1e9e-4860-a1d5-9c9911b1879e.png)

- VPC나 AWS 서비스와 다른 네트워크를 전용선으로 연결하는 서비스이다.

  

- AWS에는 AWS Direct Connect 엔드포인트를 연결점으로 접속한다. 

  

- 전용선에 접속하기 때문에 회선 공사가 필요하다.

  

- AWS에 해당 접속을 처리할 라우터를 설치해야 하므로 도입 규모가 크며 월 비용도 많이 발생한다.

  

- 비용을 절약하고 간단하게 도입하고 싶다면 AWS 파트너가 제공하는 AWS Direct Connect  공유 설비를 사용한 연결 서비스를 사용하는 방법도 있다.

  

- 프라이빗 연결과 퍼블릭 연결이 있다.

  - 프라이빗 연결은 VPC와 연결하는데, VPC에 사설 게이트웨이를 구축하고 이를 경유하여 통신하는 방법이다.

    

  - 기본 설정은 1대1 연결이지만, AWS Direct Connect 게이트웨이 (컴포넌트중 하나) 를 구축하면 이를 분기점으로 1대다로 연결할 수도 있다.

    

  - VPC를 지원하지 않는 서비스 (S3나 DynamoDB 등)을 사용할 수 없는 경우 퍼블릭 연결을 사용한다. 퍼블릭 연결은 각 서비스와 직접 연결한다.





<br>



#### AWS VPN

- 인터넷 VPN을 사용하여 다른 네트워크와 연결하는 방법이다. 인터넷을 이용한 연결이므로 회사 내 VPN 을 지원하는 라우터가 설치되어 있다면 사용가능하다.

  

- 구체적으로는 VPC에 VPG(Virtual Private Gateway)를 구축하고 연결할 때는 회사 내에 VPN을 지원하는 라우터를 사용한다.

  

- 이 라우터는 일반적인 VPN을 지원하는 라우터이지만, AWS 용어로 고객 게이트웨이라 한다.

  

- VPG를 생성하면 주요 라우터 기종의 설정 파일을 내려받을 수 있으므로 이를 수정하여 라우터를 설정하면 쉽게 사용할 수 있다.

  

- AWS VPN은 간단한 반면 인터넷을 사용하므로 네트워크 품질과 속도를 보장하지 않는다.

  

- 회선이 끊어지거나 느려질 때 서비스에 문제가 발생하는 곳에서는 AWS VPN보다는 AWS Direct Connect를 쓰는편이 좋다.

  

- AWS VPN은 퍼블릭 연결, 프라이빗 연결과 같은 구분이 없고 VPC만 접속할 수 있다.

  - VPC를 지원하지 않는 서비스에 접속해야 할 경우, VPC에 연결한 다음 이를 해당 서비스로 연결한다.



<br>



#### 전송 게이트웨이

![제목 없음](https://user-images.githubusercontent.com/50399804/134238998-b3366b9d-b832-40a1-9ef7-bd5951d16ff3.png)

- VPC나 온프레미스 네트워크(AWS Direct Connect 게이트웨이나 VPC 연결) 을 하나로 묶어 서로 연결하는 '접속점' 을 제공하는 서비스를 말한다.

  

- 서로 다른 AWS 계정도 연결할 수 있다. 네트워크끼리 연결할 때는 어떤 네트워크와 어떤 네트워크를 연결하는게 좋을지, 그리고 그 경로를 어떻게 할지 하나씩 설정하는것이 기본이다.

  

- 수가 많아지면 VPC 피어링, AWS Direct Connect 게이트웨이 등을 개별로 구축해야 하므로 굉장히 복잡해진다.

  

- 전송 게이트웨이는 이러한 네트워크 여러 개를 중앙 거점으로 집약하여 통신 경로를 통합적으로 처리하는 서비스이다.



